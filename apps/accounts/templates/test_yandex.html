<!-- Создайте файл test_yandex.html в static или templates -->
<!DOCTYPE html>
<html>
<head>
    <title>Test Yandex Cookies</title>
</head>
<body>
    <h1>Тест Яндекс кук</h1>
    
    <div>
        <h3>1. Установить тестовые куки</h3>
        <button onclick="setCookies()">Установить куки</button>
        <pre id="setResult"></pre>
    </div>
    
    <div>
        <h3>2. Проверить куки</h3>
        <button onclick="checkCookies()">Проверить</button>
        <pre id="checkResult"></pre>
    </div>
    
    <div>
        <h3>3. Тест аутентификации</h3>
        <button onclick="testAuth()">Тест аутентификации</button>
        <pre id="authResult"></pre>
    </div>
    
    <div>
        <h3>4. Проверить реальные Яндекс куки</h3>
        <p>Только в Яндекс.Браузере с авторизацией</p>
        <button onclick="checkRealYandex()">Проверить yandex.ru</button>
        <pre id="realYandexResult"></pre>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000/api';
        
        async function setCookies() {
            const response = await fetch(`${API_BASE}/auth/yandex/set-cookies/`, {
                credentials: 'include'  // ВАЖНО! Отправляем куки
            });
            const data = await response.json();
            document.getElementById('setResult').textContent = JSON.stringify(data, null, 2);
        }
        
        async function checkCookies() {
            const response = await fetch(`${API_BASE}/auth/yandex/check-cookies/`, {
                credentials: 'include'
            });
            const data = await response.json();
            document.getElementById('checkResult').textContent = JSON.stringify(data, null, 2);
            
            // Показываем куки из document.cookie
            console.log('document.cookie:', document.cookie);
        }
        
        async function testAuth() {
            const response = await fetch(`${API_BASE}/auth/yandex/test/`, {
                credentials: 'include'
            });
            const data = await response.json();
            document.getElementById('authResult').textContent = JSON.stringify(data, null, 2);
        }
        
        async function checkRealYandex() {
            try {
                // Пытаемся получить реальные Яндекс куки (только если авторизованы)
                const response = await fetch('https://yandex.ru', {
                    credentials: 'include',
                    mode: 'no-cors'  // Для обхода CORS
                });
                document.getElementById('realYandexResult').textContent = 
                    'Запрос отправлен. Проверьте Network в DevTools.';
            } catch (error) {
                document.getElementById('realYandexResult').textContent = 
                    'Ошибка: ' + error.message + '\n\n' +
                    'Это нормально - Яндекс не дает читать свои куки с других доменов.';
            }
        }
        
        // Автоматически устанавливаем куки при загрузке
        window.addEventListener('load', () => {
            // Устанавливаем тестовые куки через JS
            document.cookie = 'js_test_cookie=test_value; path=/; max-age=3600';
            document.cookie = 'js_yandex_test=test_yandex; path=/; max-age=3600';
            console.log('JS cookies set');
        });
    </script>
</body>
</html>