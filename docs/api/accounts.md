# Техническая документация на ендпоинты категории **accounts**

## GET /users/

### Описание
Данный ендпоинт служебный. Выдаёт список всех пользователей, прошедших первый этап процедуры регистрации.

### Требования
- Запрашивающий пользователь должен относиться к группе **admin** или **moderator**.

## GET /users/{id}/

### Описание
Данный ендпоинт служебный. Выдаёт конкретного пользователя по его `id`, прошедшего первый этап процедуры регистрации.

### Требования
- Запрашивающий пользователь должен относиться к группе **admin** или **moderator**.

## POST /users/

### Описание
Для регистрации нового пользователя нужно заполнить форму на клиенте (или заполнить **request body**).

Процедура регистрации делится на 2 этапа:
1. Регистрация email для аутентификации;
2. Подтверждение email.

**Первый этап** может быть успешно завершён только в одном случае: если пользователь ввёл корректные данные (email, password) и поставил 2 галочки (принятие политки конфиденциальности и согласие на обработку персональных данных).

Успешность **первого этапа** проверяется на стороне бекэнда (в случае фронтенда, отсутствие галочек не позволит отправить форму на сервер) при помощи валидиции полей. Все поля обязательны для ввода.

В случае успеха возвращается контент и отправляется код на указанный email:
- **pk** — уникальный идентификатор пользователя;
- **email** — указанный при регистрации email.

Также, в случае успеха хэшируются документы с [политикой конфиденциальности]() и [согласием на обработку персональных данных](). Хэши сохраняются в соответствующие таблицы БД. При любом изменении документов у пользователя запрашивается повторное их принятие.

### Требования
- Никаких предварительных требований нет.

### Поля запроса
| Поле | Тип | Обязательное | Описание |
|------|-----|-------------|----------|
| `email` | string | Да | Email пользователя |
| `password` | string | Да | Пароль, соответствующий требованиям ресурса |
| `consent_policy` | boolean | Да | **true** - политика конфиденциальности принята |
| `personal_consent` | boolean | Да | **true** - дано согласие на обработку персональных данных |

Второй этап подробно описан в ендпоинте **/users/email/confirm/**.

## GET /users/email/confirm

### Описание
Данный ендпоинт повторно отправляет секретный **код** на указанный при регистрации **email**. Далее необходимо повторно пройти процедуру подтверждения **email**.

### Требования
- Предварительно, должен быть пройден первый этап процедуры регистрации.
- Предварительно, email не должен быть потверждённым, иначе повторный код отправлен не будет.

## POST /users/email/confirm/

### Описание
Данный ендпоинт проверяет секретный **код**, отправленный на указанный при регистрации **email**.

Успешность подтверждения проводится на стороне бэкенда, в том чиле и при валидации переданных полей, и в базу данных записывается результат проверки. Если **email** подтверждён, то пользователь может использовать свой **email** и **пароль** для авторизации. В противном случае нужно будет провести повторную проверку.

В случае успеха или провала возвращается контент:
- **verification** — passed, если email подтверждён, failed - в противном случае.

### Требования
- Предварительно, должна быть пройдена процедура регистрации.

### Поля запроса
| Поле | Тип | Обязательное | Описание |
|------|-----|-------------|----------|
| `email` | string | Да | Email пользователя |
| `confirmation_code` | string | Да | 4-х значный код из email |

## PATCH /users/password/

### Описание
Данный ендпоинт позволяет сменить пароль пользователя.

Успешность изменения пароля проводится на стороне бэкенда путём валидации поля с паролем.

В случае успеха или провала возвращается контент:
- **message** — сообщение с результатом изменения пароля;
- **success** — статус успешности (**true** или **false**).

### Требования
- Предварительно, должна быть полностью пройдена процедура регистрации.
- Пользователь должен быть авторизован в системе.

### Поля запроса
| Поле | Тип | Обязательное | Описание |
|------|-----|-------------|----------|
| `password` | string | Да | Пароль, соответствующий требованиям ресурса |
